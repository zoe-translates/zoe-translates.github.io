(()=>{var L=(e,t,n)=>new Promise((r,s)=>{var o=i=>{try{a(n.next(i))}catch(l){s(l)}},c=i=>{try{a(n.throw(i))}catch(l){s(l)}},a=i=>i.done?r(i.value):Promise.resolve(i.value).then(o,c);a((n=n.apply(e,t)).next())});var I={noResults:"No results found."},d={indexURI:"/searchindex.json",lunrLanguages:["en","ru"],maxSummaryLength:100};var y,E;function M(){return L(this,null,function*(){try{let e=yield fetch(d.indexURI);if(e.status!==200)return;y=yield e.json(),E=lunr(function(){if(Array.isArray(d.lunrLanguages)){let t=new Set;d.lunrLanguages.forEach(r=>t.add(r)),t.add("en");let n=lunr.multiLanguage(...t);this.use(n)}this.field("author"),this.field("title"),this.field("tag"),this.field("section"),this.field("content"),this.ref("revid"),this.metadataWhitelist=["position"],y.forEach(t=>this.add(t))}),document.dispatchEvent(new CustomEvent("indexed"))}catch(e){console.log(e)}})}var N=document.getElementById("search-display-tpl").content,g=document.getElementById("search-input-container"),T=document.getElementById("search-error-container"),B=document.getElementById("search-error-content"),k=document.getElementById("results-count"),S=document.getElementById("search-results-body"),h=document.getElementById("search"),p;function A(e){if(!e){x();return}if(typeof p!="undefined"&&e===p)return;let t=Q(e);if(p=e,!t.length){F(I.noResults),x();return}P(),$(e,t)}function Q(e){let t=e,n=j(e),r;try{r=C(n)}catch(s){if(s instanceof lunr.QueryParseError)return[];throw s}return r.length>0?r:n!==t?C(t):[]}function C(e){return typeof E=="undefined"?[]:E.search(e).map(t=>{let n=y[t.ref];return n.score=t.score,n.metadata=t.matchData.metadata,n})}function j(e){let t=e.split(" ");return t.length===1?e:t.map(r=>`+${r}`).join(" ")}function F(e){g.classList.add("form-item-error"),g.classList.remove("focused"),B.textContent=e,T.classList.remove("hide-element")}function P(){g.classList.add("focused"),g.classList.remove("form-item-error"),T.classList.add("hide-element"),B.textContent=""}function x(){document.getElementById("search-results").classList.add("hide-element")}function $(e,t){H(),U(e,t),G()}function H(){S.innerHTML="",k.textContent=""}function U(e,t){let n=document.createDocumentFragment();S.innerHTML="";for(let r in t){let s=t[r],o=N.cloneNode(!0),c=D(s.metadata),a=o.querySelector("article");a.dataset.score=s.score.toFixed(2);let i=o.querySelector("a");i.href=s.href,i.innerHTML=c.title?v(s.title,c.title):s.title;let l=o.querySelector(".tm-date");l.textContent=s.date;let f=o.querySelector(".tm-author");f.innerHTML=c.author?v(s.author,c.author):s.author;let m=o.querySelector(".post-content");m.innerHTML=W(e,s.content),n.appendChild(o)}S.appendChild(n),k.textContent=t.length}function D(e){let t={};for(let[,r]of Object.entries(e))for(let[s,{position:o}]of Object.entries(r)){t[s]||(t[s]=[]);for(let[c,a]of o)t[s].push([c,c+a])}let n;for(let r in t)n=t[r],n.sort((s,o)=>s[0]-o[0]),t[r]=q(n);return t}function q(e){if(!e.length)return e;let t=[],n=0,r=e[0][1];t[0]=e[0];for(let[s,o]of e.slice(1))s<=r?o>r&&(t[n][1]=o,r=o):(t.push([s,o]),r=o,n++);return t}function v(e,t){let n=[],r=0;for(let[s,o]of t)n.push(e.slice(r,s)),n.push('<mark class="search-item">'),n.push(e.slice(s,o)),n.push("</mark>"),r=o;return n.push(e.slice(r)),n.join("")}function W(e,t){let n=new RegExp(K(e),"gmi"),r=new RegExp(/(?=[^])(?:\P{Sentence_Terminal}|\p{Sentence_Terminal}(?!['"`\p{Close_Punctuation}\p{Final_Punctuation}\s]))*(?:\p{Sentence_Terminal}+['"`\p{Close_Punctuation}\p{Final_Punctuation}]*|$)/,"guy"),s=Array.from(t.matchAll(n),l=>l.index),o=Array.from(t.matchAll(r),l=>l.index),c="",a="",i=0;for(let l of s){if(l>i){for(let u=0;u<o.length;u++)if(o[u]>l){let O=u>0?o[u-1]+1:0,R=o[u];i=R,c=t.slice(O,R).trim(),a+=`${c} ... `;break}}let f=_(a),m=f.filter(u=>u.length>50);if(m.length>0&&(a=X(a,m)),f.length>=d.maxSummaryLength)break}return J(a,d.maxSummaryLength).replace(n,'<mark class="search-item">$&</mark>')}function K(e){let t=RegExp.escape(e);return t.split(" ").length===1?`(${t})`:`(${t.split(" ").join("|")})`}function _(e){let t=/\b(\w*)[\W|\s|\b]?/gm;return Array.from(e.matchAll(t),r=>r).map(r=>({word:r[0],start:r.index,end:r.index+r[0].length,length:r[0].length}))}function X(e,t){return t.forEach(n=>{let r=z(n.word,20);e=e.replace(n.word,r)}),e}function z(e,t){let n="",r=e.length/t|0,s=e.length%t>0;s&&(r+=1);for(let o=0;o<r;o++){let c=o*t,a=c+t;s&&o===r-1&&(a=e.length),n+=e.slice(c,a)+" "}return n}function G(){document.getElementById("search-results").classList.remove("hide-element")}function J(e,t){let n=_(e);return n.length<=t?e:e.slice(0,n[t].end)+"..."}Object.prototype.hasOwnProperty.call(RegExp,"escape")||(RegExp.escape=function(e){return e.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")});String.prototype.matchAll||(String.prototype.matchAll=function(e){function t(r,s){return r.includes(s)?r:r+s}function*n(r,s){let o=new RegExp(s,t(s.flags,"g")),c;for(;c=o.exec(r);)c.index=o.lastIndex-c[0].length,yield c}return n(this,e)});function V(e){return new Proxy(new URLSearchParams(window.location.search),{get:(n,r)=>n.get(r)})[e]}function Y(e){return e.split(/\s/).filter(t=>!!t).join(" ").toLowerCase()}var b=document.getElementById("sidebar-checkbox");function Z(e){b.checked=0}M();document.addEventListener("DOMContentLoaded",()=>{let e=document.getElementById("search-form");e===null||h===null||(e.addEventListener("submit",t=>t.preventDefault()),b!==null&&h.addEventListener("mouseup",Z),h.addEventListener("keyup",t=>{t.preventDefault();let n=Y(h.value);A(n)}),h.addEventListener("input",t=>{t.currentTarget.value||(x(),P())}))});document.addEventListener("indexed",()=>{let e=V("q");e&&(h.value=e,A(e))});})();
