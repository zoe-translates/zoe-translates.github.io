(()=>{var m={noResults:"No results found."},h={indexURI:"/searchindex.json",lunrLanguages:["en","ru"],maxSummaryLength:100};var p,g;async function D(){try{let e=await fetch(h.indexURI);if(e.status!==200)return;p=await e.json(),g=lunr(function(){if(Array.isArray(h.lunrLanguages)){let t=new Set;h.lunrLanguages.forEach(r=>t.add(r)),t.add("en");let n=lunr.multiLanguage(...t);this.use(n)}this.use(P),this.field("author"),this.field("title"),this.field("content"),this.ref("revid"),this.metadataWhitelist=["position"],p.forEach(t=>this.add(t))}),document.dispatchEvent(new CustomEvent("indexed"))}catch(e){console.log(e)}}var F=new RegExp(/[\u0300-\u036f]/g);function L(e){return e.normalize("NFD").replace(F,"")}function P(e){function t(n){let r=n.toString();return n.update(()=>L(r))}lunr.Pipeline.registerFunction(t,"normalizeDiac"),e.pipeline.before(lunr.stemmer,t)}var O=document.getElementById("search-display-tpl").content,j=document.getElementById("mark-tpl").content,f=document.getElementById("search-input-container"),v=document.getElementById("search-error-container"),w=document.getElementById("search-error-content"),_=document.getElementById("results-count"),E=document.getElementById("search-results-body"),l=document.getElementById("search"),B,y=!1;function N(e){let t=H(e);if(B=e,!t.length){y=!0,T(m.noResults),x();return}y=!1,S(),K(e,t)}function H(e){let t=W(e);if(!t)return[];let n;try{n=Q(t)}catch(r){if(r instanceof lunr.QueryParseError)return[];throw r}return n}function Q(e){return typeof g=="undefined"?[]:g.search(e).map(t=>{let n=p[t.ref];return n.score=t.score,n.metadata=t.matchData.metadata,n})}var U=new RegExp("\\p{sc=Han}","u");function z(e){return U.test(e)?!0:e.startsWith("+")||e.startsWith("-")?e.length>2:e.length>1}function W(e){let t=e.split(" ").filter(z);return t.every(n=>n.startsWith("-"))?"":t.join(" ")}function T(e){f.classList.add("form-item-error"),f.classList.remove("focused"),w.textContent=e,v.classList.remove("hide-element")}function S(){f.classList.add("focused"),f.classList.remove("form-item-error"),v.classList.add("hide-element"),w.textContent=""}function M(){document.getElementById("search-results").classList.remove("hide-element")}function x(){document.getElementById("search-results").classList.add("hide-element")}function K(e,t){X(),G(e,t),M()}function X(){E.textContent="",_.textContent=""}function G(e,t){let n=new DocumentFragment;for(let r in t){let o=t[r],s=O.cloneNode(!0),c=J(o.metadata),u=s.querySelector("article");u.dataset.score=o.score.toFixed(2);let a=s.querySelector("a"),i=[];a.href=o.href,c.title?C(i,o.title,c.title):i.push(o.title),a.append(...i);let d=s.querySelector(".tm-date");d.textContent=o.date;let q=s.querySelector(".tm-author");i=[],c.author?C(i,o.author,c.author):i.push(o.author),q.append(...i);let A=s.querySelector(".post-content");c.content?i=$(o.content,c.content):(i=[o.content.slice(0,100)],o.content.length>100&&i.push(" \u2026")),A.append(...i),n.appendChild(s)}E.textContent="",E.appendChild(n),_.textContent=t.length.toString()}function J(e){let t={};for(let[,r]of Object.entries(e))for(let[o,{position:s}]of Object.entries(r)){t[o]||(t[o]=[]);for(let[c,u]of s)t[o].push([c,c+u])}let n;for(let r in t)n=t[r],n.sort((o,s)=>o[0]-s[0]),t[r]=V(n);return t}function V(e){if(!e.length)return e;let t=[],n=0,r=e[0][1];t[0]=e[0];for(let[o,s]of e.slice(1))o>r?(t.push([o,s]),r=s,n++):s>r&&(t[n][1]=s,r=s);return t}function Y(e){let t=j.cloneNode(!0),n=t.querySelector("mark");return n.textContent=e,t}function C(e,t,n,r=0){let o=0;for(let[s,c]of n)s-=r,c-=r,e.push(t.slice(o,s)),e.push(Y(t.slice(s,c))),o=c;e.push(t.slice(o))}function Z(e,t,n){if(!t.length)return[];let[r,o]=t[0],s=[{context:R(r-n,o+n,e),mark:[[r,o]]}],c=s[0],u,a;for(let[i,d]of t.slice(1))[u,a]=R(i-n,d+n,e),[r,o]=c.context,u<=o?(c.context[1]=a,c.mark.push([i,d])):(c={},c.context=[u,a],c.mark=[[i,d]],s.push(c));return s}function R(e,t,n){return[Math.max(0,e),Math.min(t,n)]}function $(e,t,n=45){let r=[],o=Z(e.length,t,n);o[0].context[0]>0&&r.push("\u2026 ");let s=o.length-1;for(let c=0;c<=s;c++){let u=o[c],a=u.context[0],i=e.slice(...u.context);c!=s&&(i+=" \u2026 "),C(r,i,u.mark,a)}return o[o.length-1].context[1]<e.length&&r.push(" \u2026"),r}function ee(e){return new Proxy(new URLSearchParams(window.location.search),{get:(n,r)=>n.get(r)})[e]}function b(e){return L(e).split(/\s/).filter(t=>!!t).join(" ").toLowerCase()}var k=document.getElementById("sidebar-checkbox");function te(e){k.checked=0}function ne(e){if(e.isComposing)return;if(e.preventDefault(),!l.value){S(),x();return}let t=b(l.value);if(!t){S(),x();return}if(t===B){y?T(m.noResults):M();return}N(t)}D();document.addEventListener("DOMContentLoaded",()=>{let e=document.getElementById("search-form");e===null||l===null||(e.addEventListener("submit",t=>t.preventDefault()),k!==null&&l.addEventListener("click",te),l.addEventListener("input",ne))});document.addEventListener("indexed",()=>{let e=ee("q");if(e){l.value=e;let t=b(e);t&&N(t)}});})();
