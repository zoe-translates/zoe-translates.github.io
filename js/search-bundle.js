(()=>{var d={noResults:"No results found."},h={indexURI:"/searchindex.json",lunrLanguages:["en","ru"],maxSummaryLength:100};var m,p;async function j(){try{let t=await fetch(h.indexURI);if(t.status!==200)return;m=await t.json(),p=lunr(function(){if(Array.isArray(h.lunrLanguages)){let e=new Set;h.lunrLanguages.forEach(n=>e.add(n)),e.add("en");let o=lunr.multiLanguage(...e);this.use(o)}this.use(D),this.field("author"),this.field("title"),this.field("content"),this.ref("revid"),this.metadataWhitelist=["position"],m.forEach(e=>this.add(e))}),document.dispatchEvent(new CustomEvent("indexed"))}catch(t){console.log(t)}}var q=new RegExp(/[\u0300-\u036f]/g);function L(t){return t.normalize("NFD").replace(q,"")}function D(t){function e(o){let n=o.toString();return o.update(()=>L(n))}lunr.Pipeline.registerFunction(e,"normalizeDiac"),t.pipeline.before(lunr.stemmer,e)}var H=document.getElementById("search-display-tpl").content.querySelector("article"),_=document.createElement("mark");_.className="search-hit";var w=document.getElementById("search-input-container"),v=document.getElementById("search-error-container"),N=document.getElementById("search-error-content"),O=document.getElementById("search-results"),T=document.getElementById("results-count"),g=document.getElementById("search-results-body"),l=document.getElementById("search"),b,E=!1;function B(t){let e=Q(t);if(b=t,!e.length){E=!0,M(d.noResults),S();return}E=!1,y(),X(t,e)}function Q(t){let e=K(t);if(!e)return[];let o;try{o=z(e)}catch(n){if(n instanceof lunr.QueryParseError)return[];throw n}return o}function z(t){return typeof p=="undefined"?[]:p.search(t).map(e=>{let o=m[e.ref];return o.score=e.score,o.metadata=e.matchData.metadata,o})}var U=new RegExp("\\p{sc=Han}","u");function W(t){return U.test(t)?!0:t.startsWith("+")||t.startsWith("-")?t.length>2:t.length>1}function K(t){let e=t.split(" ").filter(W);return e.every(o=>o.startsWith("-"))?"":e.join(" ")}function M(t){w.classList.add("form-item-error"),N.textContent=t,v.classList.remove("hide-element")}function y(){w.classList.remove("form-item-error"),v.classList.add("hide-element"),N.textContent=""}function k(){O.classList.remove("hide-element")}function S(){O.classList.add("hide-element")}function X(t,e){G(),J(t,e),k()}function G(){g.textContent="",T.textContent=""}function x(t,e,o){let n=[];o?A(n,e,o):n.push(e),t.append(...n)}var C=new DocumentFragment;function J(t,e){for(let o=0;o<e.length;o++){let n=e[o],r=H.cloneNode(!0),s=V(n.metadata),c=r.querySelector("a");x(c,n.title,s.title),c.href=n.href;let i=r.querySelector(".tm-date");i.textContent=n.date;let a=r.querySelector(".tm-author");x(a,n.author,s.author);let u=r.querySelector(".post-content");s.content?ts=ee(n.content,s.content):(ts=[n.content.slice(0,100)],n.content.length>100&&ts.push(" \u2026")),u.append(...ts),r.dataset.score=n.score.toFixed(2),r.normalize(),C.appendChild(r)}g.textContent="",g.appendChild(C),T.textContent=e.length.toString()}function V(t){let e={};for(let[,o]of Object.entries(t))for(let[n,{position:r}]of Object.entries(o)){e[n]||(e[n]=[]);for(let[s,c]of r)e[n].push([s,s+c])}for(let[o,n]of Object.entries(e))n.sort((r,s)=>r[0]-s[0]),e[o]=Y(n);return e}function Y(t){if(!t.length)return t;let e=[],o=0,n=t[0][1];e[0]=t[0];for(let[r,s]of t.slice(1))r>n?(e.push([r,s]),n=s,o++):s>n&&(e[o][1]=s,n=s);return e}function Z(t){let e=_.cloneNode(!1);return e.textContent=t,e}function A(t,e,o,n=0){let r=0;for(let[s,c]of o)s-=n,c-=n,t.push(e.slice(r,s)),t.push(Z(e.slice(s,c))),r=c;t.push(e.slice(r))}function $(t,e,o){if(!e.length)return[];let[n,r]=e[0],s=[{context:I(n-o,r+o,t),mark:[[n,r]]}],c=s[0],i,a;for(let[u,f]of e.slice(1))[i,a]=I(u-o,f+o,t),[n,r]=c.context,i<=r?(c.context[1]=a,c.mark.push([u,f])):(c={},c.context=[i,a],c.mark=[[u,f]],s.push(c));return s}function I(t,e,o){return[Math.max(0,t),Math.min(e,o)]}function ee(t,e,o=45){let n=[],r=$(t.length,e,o);r[0].context[0]>0&&n.push("\u2026 ");let s=r.length-1;for(let c=0;c<=s;c++){let i=r[c],a=i.context[0],u=t.slice(...i.context);c!=s&&(u+=" \u2026 "),A(n,u,i.mark,a)}return r[r.length-1].context[1]<t.length&&n.push(" \u2026"),n}function te(t){return new Proxy(new URLSearchParams(window.location.search),{get:(o,n)=>o.get(n)})[t]}function F(t){return L(t).split(/\s/).filter(e=>!!e).join(" ").toLowerCase()}var P=document.getElementById("sidebar-checkbox");function ne(t){P.checked=0}function oe(t){if(t.isComposing)return;if(!l.value){y(),S();return}let e=F(l.value);if(!e){y(),S();return}if(e===b){E?M(d.noResults):k();return}B(e)}document.addEventListener("DOMContentLoaded",()=>{let t=document.getElementById("search-form");t===null||l===null||(t.addEventListener("submit",e=>e.preventDefault()),P!==null&&l.addEventListener("click",ne),l.addEventListener("input",oe))});document.addEventListener("indexed",()=>{let t=te("q");if(t){let e=F(t);e&&B(e),l.value=t}});j();})();
