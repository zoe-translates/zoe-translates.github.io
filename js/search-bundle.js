(()=>{var x=(e,t,n)=>new Promise((o,r)=>{var s=i=>{try{a(n.next(i))}catch(u){r(u)}},c=i=>{try{a(n.throw(i))}catch(u){r(u)}},a=i=>i.done?o(i.value):Promise.resolve(i.value).then(s,c);a((n=n.apply(e,t)).next())});var I={noResults:"No results found."},f={indexURI:"/searchindex.json",lunrLanguages:["en","ru"],maxSummaryLength:100};var p,y;function j(){return x(this,null,function*(){try{let e=yield fetch(f.indexURI);if(e.status!==200)return;p=yield e.json(),y=lunr(function(){if(Array.isArray(f.lunrLanguages)){let t=new Set;f.lunrLanguages.forEach(o=>t.add(o)),t.add("en");let n=lunr.multiLanguage(...t);this.use(n)}this.field("author"),this.field("title"),this.field("content"),this.ref("revid"),this.metadataWhitelist=["position"],p.forEach(t=>this.add(t))}),document.dispatchEvent(new CustomEvent("indexed"))}catch(e){console.log(e)}})}var O=document.getElementById("search-display-tpl").content,g=document.getElementById("search-input-container"),T=document.getElementById("search-error-container"),w=document.getElementById("search-error-content"),B=document.getElementById("results-count"),E=document.getElementById("search-results-body"),l=document.getElementById("search"),m;function M(e){if(!e){L();return}if(typeof m!="undefined"&&e===m)return;let t=Q(e);if(m=e,!t.length){P(I.noResults),L();return}N(),A(e,t)}function Q(e){let t=e,n=H(e),o;try{o=v(n)}catch(r){if(r instanceof lunr.QueryParseError)return[];throw r}return o.length>0?o:n!==t?v(t):[]}function v(e){return typeof y=="undefined"?[]:y.search(e).map(t=>{let n=p[t.ref];return n.score=t.score,n.metadata=t.matchData.metadata,n})}function H(e){let t=e.split(" ");return t.length===1?e:t.map(o=>`+${o}`).join(" ")}function P(e){g.classList.add("form-item-error"),g.classList.remove("focused"),w.textContent=e,T.classList.remove("hide-element")}function N(){g.classList.add("focused"),g.classList.remove("form-item-error"),T.classList.add("hide-element"),w.textContent=""}function _(){document.getElementById("search-results").classList.remove("hide-element")}function L(){document.getElementById("search-results").classList.add("hide-element")}function A(e,t){F(),D(e,t),_()}function F(){E.innerHTML="",B.textContent=""}function D(e,t){let n=document.createDocumentFragment();E.innerHTML="";for(let o in t){let r=t[o],s=O.cloneNode(!0),c=U(r.metadata),a=s.querySelector("article");a.dataset.score=r.score.toFixed(2);let i=s.querySelector("a");i.href=r.href,i.innerHTML=c.title?S(r.title,c.title):r.title;let u=s.querySelector(".tm-date");u.textContent=r.date;let d=s.querySelector(".tm-author");d.innerHTML=c.author?S(r.author,c.author):r.author;let b=s.querySelector(".post-content"),h;c.content?h=K(r.content,c.content):(h=r.content.slice(0,100),r.content.length>100&&(h+=" \u2026")),b.innerHTML=h,n.appendChild(s)}E.appendChild(n),B.textContent=t.length}function U(e){let t={};for(let[,o]of Object.entries(e))for(let[r,{position:s}]of Object.entries(o)){t[r]||(t[r]=[]);for(let[c,a]of s)t[r].push([c,c+a])}let n;for(let o in t)n=t[o],n.sort((r,s)=>r[0]-s[0]),t[o]=q(n);return t}function q(e){if(!e.length)return e;let t=[],n=0,o=e[0][1];t[0]=e[0];for(let[r,s]of e.slice(1))r>o?(t.push([r,s]),o=s,n++):s>o&&(t[n][1]=s,o=s);return t}function S(e,t,n=0){let o=[],r=0;for(let[s,c]of t)s-=n,c-=n,o.push(e.slice(r,s)),o.push('<mark class="search-item">'),o.push(e.slice(s,c)),o.push("</mark>"),r=c;return o.push(e.slice(r)),o.join("")}function z(e,t,n){if(!t.length)return[];let[o,r]=t[0],s=[{context:R(o-n,r+n,e),mark:[[o,r]]}],c=s[0],a,i;for(let[u,d]of t.slice(1))[a,i]=R(u-n,d+n,e),[o,r]=c.context,a<=r?(c.context[1]=i,c.mark.push([u,d])):(c={},c.context=[a,i],c.mark=[[u,d]],s.push(c));return s}function R(e,t,n){return[Math.max(0,e),Math.min(t,n)]}function K(e,t,n=45){let o=[],r=z(e.length,t,n);return r[0].context[0]>0&&o.push(""),r.forEach(s=>{let c=s.context[0],a=e.slice(...s.context),i=S(a,s.mark,c);o.push(i)}),r[r.length-1].context[1]<e.length&&o.push(""),o.join(" \u2026 ")}function W(e){return new Proxy(new URLSearchParams(window.location.search),{get:(n,o)=>n.get(o)})[e]}function X(e){return e.split(/\s/).filter(t=>!!t).join(" ").toLowerCase()}var k=document.getElementById("sidebar-checkbox");function $(e){k.checked=0}j();document.addEventListener("DOMContentLoaded",()=>{let e=document.getElementById("search-form");e===null||l===null||(e.addEventListener("submit",t=>t.preventDefault()),k!==null&&l.addEventListener("mouseup",$),l.addEventListener("keyup",t=>{t.preventDefault();let n=X(l.value);M(n)}),l.addEventListener("input",t=>{t.currentTarget.value||(L(),N(),m=void 0)}))});document.addEventListener("indexed",()=>{let e=W("q");e&&(l.value=e,M(e))});})();
