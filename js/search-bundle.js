(()=>{var m={noResults:"No results found."},f={indexURI:"/searchindex.json",lunrLanguages:["en","ru"],maxResults:25,maxSummaryLength:100};var g,p;async function q(){try{let e=await fetch(f.indexURI);if(e.status!==200)return;g=await e.json(),p=lunr(function(){if(Array.isArray(f.lunrLanguages)){let t=new Set;f.lunrLanguages.forEach(n=>t.add(n)),t.add("en");let o=lunr.multiLanguage(...t);this.use(o)}this.use(H),this.field("author"),this.field("title"),this.field("content"),this.ref("revid"),this.metadataWhitelist=["position"],g.forEach(t=>this.add(t))}),document.dispatchEvent(new CustomEvent("indexed"))}catch(e){console.log(e)}}var D=new RegExp(/[\u0300-\u036f]/g);function _(e){return e.normalize("NFD").replace(D,"")}function H(e){function t(o){let n=o.toString();return o.update(()=>_(n))}lunr.Pipeline.registerFunction(t,"normalizeDiac"),e.pipeline.before(lunr.stemmer,t)}var Q=document.getElementById("search-display-tpl").content.querySelector("article"),w=document.createElement("mark");w.className="search-hit";var v=document.getElementById("search-input-container"),N=document.getElementById("search-error-container"),O=document.getElementById("search-error-content"),T=document.getElementById("search-results"),b=document.getElementById("results-count"),E=document.getElementById("search-results-body"),a=document.getElementById("search"),B,y=!1;function M(e){let t=z(e);if(B=e,!t.length){y=!0,k(m.noResults),R();return}y=!1,S(),G(e,t)}function z(e){let t=X(e);if(!t)return[];let o;try{o=U(t)}catch(n){if(n instanceof lunr.QueryParseError)return[];throw n}return o}function U(e){return typeof p=="undefined"?[]:p.search(e)}var W=new RegExp("\\p{sc=Han}","u");function K(e){return W.test(e)?!0:e.startsWith("+")||e.startsWith("-")?e.length>2:e.length>1}function X(e){let t=e.split(" ").filter(K);return t.every(o=>o.startsWith("-"))?"":t.join(" ")}function k(e){v.classList.add("form-item-error"),O.textContent=e,N.classList.remove("hide-element")}function S(){v.classList.remove("form-item-error"),N.classList.add("hide-element"),O.textContent=""}function A(){T.classList.remove("hide-element")}function R(){T.classList.add("hide-element")}function G(e,t){J(),V(e,t),A()}function J(){E.textContent="",b.textContent=""}function C(e,t,o){let n=[];o?F(n,t,o):n.push(t),e.append(...n)}var I=new DocumentFragment;function V(e,t){for(let o=0;o<Math.min(t.length,f.maxResults);o++){let n=t[o],r=g[n.ref],s=Y(n.matchData.metadata),c=Q.cloneNode(!0),i=c.querySelector("a");C(i,r.title,s.title),i.href=r.href;let l=c.querySelector(".tm-date");l.textContent=r.date;let u=c.querySelector(".tm-author");C(u,r.author,s.author);let h=c.querySelector(".post-content"),d;s.content?d=te(r.content,s.content):(d=[r.content.slice(0,100)],r.content.length>100&&d.push(" \u2026")),h.append(...d),c.dataset.score=n.score.toFixed(2),c.normalize(),I.appendChild(c)}b.textContent=t.length.toString(),E.textContent="",E.appendChild(I)}function Y(e){let t={};for(let[,o]of Object.entries(e))for(let[n,{position:r}]of Object.entries(o)){t[n]||(t[n]=[]);for(let[s,c]of r)t[n].push([s,s+c])}for(let[o,n]of Object.entries(t))n.sort((r,s)=>r[0]-s[0]),t[o]=Z(n);return t}function Z(e){if(!e.length)return e;let t=[],o=0,n=e[0][1];t[0]=e[0];for(let[r,s]of e.slice(1))r>n?(t.push([r,s]),n=s,o++):s>n&&(t[o][1]=s,n=s);return t}function $(e){let t=w.cloneNode(!1);return t.textContent=e,t}function F(e,t,o,n=0){let r=0;for(let[s,c]of o)s-=n,c-=n,e.push(t.slice(r,s)),e.push($(t.slice(s,c))),r=c;e.push(t.slice(r))}function ee(e,t,o){if(!t.length)return[];let[n,r]=t[0],s=[{context:L(n-o,r+o,e),mark:[[n,r]]}],c=s[0],i,l;for(let[u,h]of t.slice(1))[i,l]=L(u-o,h+o,e),[n,r]=c.context,i<=r?(c.context[1]=l,c.mark.push([u,h])):(c={},c.context=[i,l],c.mark=[[u,h]],s.push(c));return s}function L(e,t,o){return[Math.max(0,e),Math.min(t,o)]}function te(e,t,o=45){let n=[],r=ee(e.length,t,o);r[0].context[0]>0&&n.push("\u2026 ");let s=r.length-1;for(let c=0;c<=s;c++){let i=r[c],l=i.context[0],u=e.slice(...i.context);c!=s&&(u+=" \u2026 "),F(n,u,i.mark,l)}return r[r.length-1].context[1]<e.length&&n.push(" \u2026"),n}function ne(e){return new Proxy(new URLSearchParams(window.location.search),{get:(o,n)=>o.get(n)})[e]}function P(e){return _(e).split(/\s/).filter(t=>!!t).join(" ").toLowerCase()}var j=document.getElementById("sidebar-checkbox");function oe(e){j.checked=0}function re(e){if(e.isComposing)return;if(!a.value){S(),R();return}let t=P(a.value);if(!t){S(),R();return}if(t===B){y?k(m.noResults):A();return}M(t)}document.addEventListener("DOMContentLoaded",()=>{let e=document.getElementById("search-form");e===null||a===null||(e.addEventListener("submit",t=>t.preventDefault()),j!==null&&a.addEventListener("click",oe),a.addEventListener("input",re))});document.addEventListener("indexed",()=>{let e=ne("q");if(e){let t=P(e);t&&M(t),a.value=e}});q();})();
