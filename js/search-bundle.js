(()=>{var p={noResults:"No results found."},f={indexURI:"/searchindex.json",lunrLanguages:["en","ru"],maxResults:25,maxSummaryLength:100};var g,y;async function k(){try{let e=await fetch(f.indexURI);if(e.status!==200)return;g=await e.json(),y=lunr(function(){if(Array.isArray(f.lunrLanguages)){let t=new Set;f.lunrLanguages.forEach(n=>t.add(n)),t.add("en");let o=lunr.multiLanguage(...t);this.use(o)}this.use(H),this.field("author"),this.field("title"),this.field("content"),this.ref("revid"),this.metadataWhitelist=["position"],g.forEach(t=>this.add(t))}),document.dispatchEvent(new CustomEvent("indexed"))}catch(e){console.log(e)}}var z=new RegExp(/[\u0300-\u036f]/g);function N(e){return e.normalize("NFD").replace(z,"")}function H(e){function t(o){let n=o.toString();return o.update(()=>N(n))}lunr.Pipeline.registerFunction(t,"normalizeDiac"),e.pipeline.before(lunr.stemmer,t)}var Q=document.getElementById("search-display-tpl").content.querySelector("article"),v=document.createElement("mark");v.className="search-hit";var l=document.getElementById("search-output-region"),b=document.getElementById("search-input-container"),O=document.getElementById("search-error-container"),T=document.getElementById("search-error-content"),B=document.getElementById("search-results"),A=document.getElementById("results-count"),E=document.getElementById("search-results-body"),d=document.getElementById("search"),q,R=!1;function M(e){l.ariaBusy="true",l.setAttribute("aria-busy","true");let t=U(e);if(q=e,!t.length){R=!0,j(p.noResults),x(),l.ariaBusy="false",l.setAttribute("aria-busy","false");return}R=!1,S(),J(e,t),l.ariaBusy="false",l.setAttribute("aria-busy","false")}function U(e){let t=K(e);if(!t)return[];let o;try{o=W(t)}catch(n){if(n instanceof lunr.QueryParseError)return[];throw n}return o}function W(e){return typeof y=="undefined"?[]:y.search(e)}var $=new RegExp("\\p{sc=Han}","u");function G(e){return $.test(e)?!0:e.startsWith("+")||e.startsWith("-")?e.length>2:e.length>1}function K(e){let t=e.split(" ").filter(G);return t.every(o=>o.startsWith("-"))?"":t.join(" ")}function j(e){b.classList.add("form-item-error"),T.textContent=e,O.classList.remove("hide-element")}function S(){b.classList.remove("form-item-error"),O.classList.add("hide-element"),T.textContent=""}function D(){B.classList.remove("hide-element")}function x(){B.classList.add("hide-element")}function J(e,t){V(),X(e,t),D()}function V(){E.textContent="",A.textContent=""}function _(e,t,o){let n=[];o?F(n,t,o):n.push(t),e.append(...n)}var w=new DocumentFragment;function X(e,t){for(let o=0;o<Math.min(t.length,f.maxResults);o++){let n=t[o],r=g[n.ref],s=Y(n.matchData.metadata),i=Q.cloneNode(!0),c=i.querySelector("a");_(c,r.title,s.title),c.href=r.href;let a=i.querySelector(".tm-date");a.textContent=r.date;let u=i.querySelector(".tm-author");_(u,r.author,s.author);let h=i.querySelector(".post-content"),m;s.content?m=ne(r.content,s.content):(m=[r.content.slice(0,100)],r.content.length>100&&m.push(" \u2026")),h.append(...m),i.dataset.score=n.score.toFixed(2),i.normalize(),w.appendChild(i)}A.textContent=t.length.toString(),E.textContent="",E.appendChild(w)}function Y(e){let t={};for(let[,o]of Object.entries(e))for(let[n,{position:r}]of Object.entries(o)){t[n]||(t[n]=[]);for(let[s,i]of r)t[n].push([s,s+i])}for(let[o,n]of Object.entries(t))n.sort((r,s)=>r[0]-s[0]),t[o]=Z(n);return t}function Z(e){if(!e.length)return e;let t=[],o=0,n=e[0][1];t[0]=e[0];for(let[r,s]of e.slice(1))r>n?(t.push([r,s]),n=s,o++):s>n&&(t[o][1]=s,n=s);return t}function ee(e){let t=v.cloneNode(!1);return t.textContent=e,t}function F(e,t,o,n=0){let r=0;for(let[s,i]of o)s-=n,i-=n,e.push(t.slice(r,s)),e.push(ee(t.slice(s,i))),r=i;e.push(t.slice(r))}function te(e,t,o){if(!t.length)return[];let[n,r]=t[0],s=[{context:L(n-o,r+o,e),mark:[[n,r]]}],i=s[0],c,a;for(let[u,h]of t.slice(1))[c,a]=L(u-o,h+o,e),[n,r]=i.context,c<=r?(i.context[1]=a,i.mark.push([u,h])):(i={},i.context=[c,a],i.mark=[[u,h]],s.push(i));return s}function L(e,t,o){return[Math.max(0,e),Math.min(t,o)]}function ne(e,t,o=45){let n=[],r=te(e.length,t,o);r[0].context[0]>0&&n.push("\u2026 ");let s=r.length-1;for(let i=0;i<=s;i++){let c=r[i],a=c.context[0],u=e.slice(...c.context);i!=s&&(u+=" \u2026 "),F(n,u,c.mark,a)}return r[r.length-1].context[1]<e.length&&n.push(" \u2026"),n}function P(e){return N(e).split(/\s/).filter(t=>!!t).join(" ").toLowerCase()}var I=new Proxy(new URLSearchParams(location.search),{get:(e,t)=>e.get(t),set:(e,t,o)=>{e.set(t,o),window.history.replaceState({},"",`${location.pathname}?${e}`)},deleteProperty:(e,t)=>{e.delete(t),window.history.replaceState({},"",`${location.pathname}`)}});function oe(e){if(e.preventDefault(),!d.value){S(),x(),delete I.q;return}let t=P(d.value);if(!t){S(),x();return}if(t===q){R?j(p.noResults):D();return}M(t),I.q=d.value}document.addEventListener("DOMContentLoaded",()=>{let e=document.getElementById("search-form");e===null||d===null||e.addEventListener("submit",oe)});document.addEventListener("indexed",()=>{let e=I.q;if(e){let t=P(e);t&&M(t),d.value=e}});k();})();
