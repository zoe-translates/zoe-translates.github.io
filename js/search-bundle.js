(()=>{var g={noResults:"No results found."},f={indexURI:"/searchindex.json",lunrLanguages:["en","ru"],maxSummaryLength:100};var p,y;async function O(){try{let e=await fetch(f.indexURI);if(e.status!==200)return;p=await e.json(),y=lunr(function(){if(Array.isArray(f.lunrLanguages)){let t=new Set;f.lunrLanguages.forEach(n=>t.add(n)),t.add("en");let o=lunr.multiLanguage(...t);this.use(o)}this.field("author"),this.field("title"),this.field("content"),this.ref("revid"),this.metadataWhitelist=["position"],p.forEach(t=>this.add(t))}),document.dispatchEvent(new CustomEvent("indexed"))}catch(e){console.log(e)}}var Q=document.getElementById("search-display-tpl").content,m=document.getElementById("search-input-container"),T=document.getElementById("search-error-container"),w=document.getElementById("search-error-content"),B=document.getElementById("results-count"),E=document.getElementById("search-results-body"),u=document.getElementById("search"),M,L=!1;function N(e){let t=_(e);if(M=e,!t.length){L=!0,b(g.noResults),x();return}L=!1,S(),q(e,t)}function _(e){let t=e,o=P(e),n;try{n=R(o)}catch(r){if(r instanceof lunr.QueryParseError)return[];throw r}return n.length>0?n:o!==t?R(t):[]}function R(e){return typeof y=="undefined"?[]:y.search(e).map(t=>{let o=p[t.ref];return o.score=t.score,o.metadata=t.matchData.metadata,o})}function P(e){let t=e.split(" ");return t.length===1?e:t.map(n=>`+${n}`).join(" ")}function b(e){m.classList.add("form-item-error"),m.classList.remove("focused"),w.textContent=e,T.classList.remove("hide-element")}function S(){m.classList.add("focused"),m.classList.remove("form-item-error"),T.classList.add("hide-element"),w.textContent=""}function j(){document.getElementById("search-results").classList.remove("hide-element")}function x(){document.getElementById("search-results").classList.add("hide-element")}function q(e,t){A(),F(e,t),j()}function A(){E.innerHTML="",B.textContent=""}function F(e,t){let o=document.createDocumentFragment();E.innerHTML="";for(let n in t){let r=t[n],s=Q.cloneNode(!0),c=D(r.metadata),i=s.querySelector("article");i.dataset.score=r.score.toFixed(2);let a=s.querySelector("a");a.href=r.href,a.innerHTML=c.title?C(r.title,c.title):r.title;let l=s.querySelector(".tm-date");l.textContent=r.date;let h=s.querySelector(".tm-author");h.innerHTML=c.author?C(r.author,c.author):r.author;let H=s.querySelector(".post-content"),d;c.content?d=K(r.content,c.content):(d=r.content.slice(0,100),r.content.length>100&&(d+=" \u2026")),H.innerHTML=d,o.appendChild(s)}E.appendChild(o),B.textContent=t.length}function D(e){let t={};for(let[,n]of Object.entries(e))for(let[r,{position:s}]of Object.entries(n)){t[r]||(t[r]=[]);for(let[c,i]of s)t[r].push([c,c+i])}let o;for(let n in t)o=t[n],o.sort((r,s)=>r[0]-s[0]),t[n]=U(o);return t}function U(e){if(!e.length)return e;let t=[],o=0,n=e[0][1];t[0]=e[0];for(let[r,s]of e.slice(1))r>n?(t.push([r,s]),n=s,o++):s>n&&(t[o][1]=s,n=s);return t}function C(e,t,o=0){let n=[],r=0;for(let[s,c]of t)s-=o,c-=o,n.push(e.slice(r,s)),n.push('<mark class="search-item">'),n.push(e.slice(s,c)),n.push("</mark>"),r=c;return n.push(e.slice(r)),n.join("")}function z(e,t,o){if(!t.length)return[];let[n,r]=t[0],s=[{context:v(n-o,r+o,e),mark:[[n,r]]}],c=s[0],i,a;for(let[l,h]of t.slice(1))[i,a]=v(l-o,h+o,e),[n,r]=c.context,i<=r?(c.context[1]=a,c.mark.push([l,h])):(c={},c.context=[i,a],c.mark=[[l,h]],s.push(c));return s}function v(e,t,o){return[Math.max(0,e),Math.min(t,o)]}function K(e,t,o=45){let n=[],r=z(e.length,t,o);return r[0].context[0]>0&&n.push(""),r.forEach(s=>{let c=s.context[0],i=e.slice(...s.context),a=C(i,s.mark,c);n.push(a)}),r[r.length-1].context[1]<e.length&&n.push(""),n.join(" \u2026 ")}function W(e){return new Proxy(new URLSearchParams(window.location.search),{get:(o,n)=>o.get(n)})[e]}function X(e){return e.split(/\s/).filter(t=>!!t).join(" ").toLowerCase()}var k=document.getElementById("sidebar-checkbox");function $(e){k.checked=0}function G(e){if(e.isComposing)return;if(e.preventDefault(),!u.value){S(),x();return}let t=X(u.value);if(!t){S(),x();return}if(t===M){L?b(g.noResults):j();return}N(t)}O();document.addEventListener("DOMContentLoaded",()=>{let e=document.getElementById("search-form");e===null||u===null||(e.addEventListener("submit",t=>t.preventDefault()),k!==null&&u.addEventListener("mouseup",$),u.addEventListener("input",G))});document.addEventListener("indexed",()=>{let e=W("q");e&&(u.value=e,N(e))});})();
