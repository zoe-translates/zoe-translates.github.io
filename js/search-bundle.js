(()=>{var x=(e,t,n)=>new Promise((r,s)=>{var a=i=>{try{o(n.next(i))}catch(l){s(l)}},c=i=>{try{o(n.throw(i))}catch(l){s(l)}},o=i=>i.done?r(i.value):Promise.resolve(i.value).then(a,c);o((n=n.apply(e,t)).next())});var E={noResults:"No results found."},d={indexURI:"/searchindex.json",lunrLanguages:["en","fr","ru"],maxSummaryLength:100};var f,m;function v(){return x(this,null,function*(){try{let e=yield fetch(d.indexURI);if(e.status!==200)return;f=yield e.json(),m=lunr(function(){if(Array.isArray(d.lunrLanguages)){let t=new Set;d.lunrLanguages.forEach(r=>t.add(r)),t.add("en");let n=lunr.multiLanguage(...t);this.use(n)}this.field("author"),this.field("title"),this.field("tag"),this.field("section"),this.field("content"),this.field("publishDate"),this.field("lastmod"),this.ref("href"),f.forEach(t=>this.add(t))}),document.dispatchEvent(new CustomEvent("indexed"))}catch(e){console.log(e)}})}function R(e){if(!e){g();return}let t=B(e);if(!t.length){M(E.noResults),g();return}T(),A(e,t)}function B(e){let t=e,n=C(e),r;try{r=L(n)}catch(s){if(s instanceof lunr.QueryParseError)return[];throw s}return r.length>0?r:n!==t?L(t):[]}function L(e){return typeof m=="undefined"?[]:m.search(e).flatMap(t=>{if(t.ref==="undefined")return[];let n=f.filter(r=>r.href===t.ref)[0];return n.score=t.score,[n]})}function C(e){let t=e.split(" ");if(t.length===1)return e;let n="";for(let r of t)n+=`+${r} `;return n.trim()}function M(e){let t=document.querySelector(".search-container");t.classList.add("form-item-error"),t.classList.remove("focused"),document.querySelector(".search-error-message").innerHTML=e,document.querySelector(".search-error").classList.remove("hide-element")}function T(){let e=document.querySelector(".search-container");e.classList.add("focused"),e.classList.remove("form-item-error"),document.querySelector(".search-error").classList.add("hide-element"),document.querySelector(".search-error-message").innerHTML=""}function g(){document.getElementById("site-search").classList.remove("expanded"),document.getElementById("search-results").classList.add("hide-element")}function A(e,t){P(),b(e,t),H()}function P(){document.getElementById("search-results-body").innerHTML="",document.getElementById("results-count").innerHTML=""}function b(e,t){let n=document.querySelector("template").content,r=document.createDocumentFragment(),s=document.getElementById("search-results-body");s.textContent="";for(let a in t){let c=t[a],o=n.cloneNode(!0),i=o.querySelector("article");i.dataset.score=c.score.toFixed(2);let l=o.querySelector("a");l.innerHTML=c.title,l.href=c.href;let h=o.querySelector(".post-content");h.innerHTML=Q(e,c.content),r.appendChild(o)}s.appendChild(r),document.getElementById("results-count").textContent=t.length}function Q(e,t){let n=new RegExp(k(e),"gmi"),r=new RegExp(/(?=[^])(?:\P{Sentence_Terminal}|\p{Sentence_Terminal}(?!['"`\p{Close_Punctuation}\p{Final_Punctuation}\s]))*(?:\p{Sentence_Terminal}+['"`\p{Close_Punctuation}\p{Final_Punctuation}]*|$)/,"guy"),s=Array.from(t.matchAll(n),l=>l.index),a=Array.from(t.matchAll(r),l=>l.index),c="",o="",i=0;for(let l of s){if(l>i){for(let u=0;u<a.length;u++)if(a[u]>l){let I=u>0?a[u-1]+1:0,p=a[u];i=p,c=t.slice(I,p).trim(),o+=`${c} ... `;break}}let h=w(o),y=h.filter(u=>u.length>50);if(y.length>0&&(o=q(o,y)),h.length>=d.maxSummaryLength)break}return _(o,d.maxSummaryLength).replace(n,'<mark class="search-item">$&</mark>')}function k(e){let t=RegExp.escape(e);return t.split(" ").length===1?`(${t})`:`(${t.split(" ").join("|")})`}function w(e){let t=/\b(\w*)[\W|\s|\b]?/gm;return Array.from(e.matchAll(t),r=>r).map(r=>({word:r[0],start:r.index,end:r.index+r[0].length,length:r[0].length}))}function q(e,t){return t.forEach(n=>{let r=$(n.word,20);e=e.replace(n.word,r)}),e}function $(e,t){let n="",r=e.length/t|0,s=e.length%t>0;s&&(r+=1);for(let a=0;a<r;a++){let c=a*t,o=c+t;s&&a===r-1&&(o=e.length),n+=e.slice(c,o)+" "}return n}function H(){document.getElementById("search-results").classList.remove("hide-element"),document.getElementById("site-search").classList.remove("expanded")}function _(e,t){let n=w(e);return n.length<=t?e:e.slice(0,n[t].end)+"..."}Object.prototype.hasOwnProperty.call(RegExp,"escape")||(RegExp.escape=function(e){return e.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")});String.prototype.matchAll||(String.prototype.matchAll=function(e){function t(r,s){return r.includes(s)?r:r+s}function*n(r,s){let a=new RegExp(s,t(s.flags,"g")),c;for(;c=a.exec(r);)c.index=a.lastIndex-c[0].length,yield c}return n(this,e)});function F(e){return new Proxy(new URLSearchParams(window.location.search),{get:(n,r)=>n.get(r)})[e]}v();document.addEventListener("DOMContentLoaded",()=>{let e=document.getElementById("search-form"),t=document.getElementById("search");e===null||t===null||(e.addEventListener("submit",n=>n.preventDefault()),t.addEventListener("keyup",n=>{n.preventDefault();let r=document.getElementById("search").value.trim().toLowerCase();R(r)}),t.addEventListener("input",n=>{n.currentTarget.value||g()}))});document.addEventListener("indexed",()=>{let e=F("q");e&&(document.getElementById("search").value=e,R(e))});})();
