"use strict";(()=>{var y={noResults:"No results found."},a={indexURI:"/searchindex.json",lunrLanguages:["en","ru"],maxHitsPerResult:5,maxResults:25};var R,q,X=fetch(a.indexURI,{mode:"same-origin"});document.getElementById("search-app").classList.remove("hide-element");var Y=new RegExp(/[\u0300-\u036f]/g);function v(t){return t.normalize("NFD").replace(Y,"")}var Z=document.getElementById("search-display-tpl").content.querySelector("article"),F=document.createElement("mark");F.className="search-hit";var E=document.getElementById("search-output-region"),H=document.getElementById("search-input-container"),M=document.getElementById("search-error-container"),Q=document.getElementById("search-error-content"),D=document.getElementById("search-results"),U=document.getElementById("results-count"),S=document.getElementById("search-results-body"),h=document.getElementById("search"),$,I=!1;function j(t){st();let e=tt(t);if($=t,!e.length){I=!0,L(y.noResults),G(),b();return}I=!1,W(),S.textContent="",U.textContent="",ct(t,e),z(),b()}function tt(t){let e=nt(t);if(!e)return[];try{return q.search(e)}catch(n){if(n instanceof lunr.QueryParseError)return[];throw n}}var C=new RegExp("\\p{sc=Han}","u");function et(t){return C.test(t)?!0:t.startsWith("+")||t.startsWith("-")?t.length>2:t.length>1}function nt(t){let e=t.split(" ").filter(et);return e.every(n=>n.startsWith("-"))?"":e.join(" ")}function ot(){h.removeAttribute("readonly");let t=document.getElementById("search-act");t&&t.removeAttribute("disabled"),h.removeAttribute("placeholder"),h.focus()}function L(t){H.classList.add("form-item-error"),Q.textContent=t,M.classList.remove("hide-element")}function W(){M.classList.add("hide-element"),H.classList.remove("form-item-error"),Q.textContent=""}function st(){E.ariaBusy="true",E.setAttribute("aria-busy","true")}function b(){E.ariaBusy="false",E.setAttribute("aria-busy","false")}function z(){D.classList.remove("hide-element")}function G(){D.classList.add("hide-element")}function rt(t){let e=F.cloneNode(!1);return e.textContent=t,e}var J=document.createElement("span");J.className="ell";function p(t){let e=J.cloneNode(!1);return e.textContent=t,e}function O(t,e,n){let o=[];n?K(o,e,n):o.push(e),t.append(...o)}var k=new DocumentFragment;function ct(t,e){let n;a.maxResults<=0?n=e.length:n=Math.min(e.length,a.maxResults);for(let o=0;o<n;o++){let r=e[o],s=R[r.ref],c=it(r.matchData.metadata),i=Z.cloneNode(!0),l=i.querySelector("a");O(l,s.title,c.title),l.href=new URL(s.r,location.origin).href;let u=i.querySelector(".tm-date");u.textContent=s.d;let m=i.querySelector(".tm-author");O(m,s.author,c.author);let g=i.querySelector(".post-content"),f;if(c.content)f=ft(s.content,c.content);else if(s.content){let x=_(s.content,100,0,-1);f=[s.content.slice(0,x)],s.content.length>x&&f.push(p(" \u2026"))}g.append(...f),i.dataset.score=r.score.toFixed(2),i.normalize(),k.appendChild(i)}U.textContent=e.length.toString(),S.textContent="",S.appendChild(k)}function it(t){let e={};for(let[,n]of Object.entries(t))for(let[o,{position:r}]of Object.entries(n)){e[o]||(e[o]=[]);for(let[s,c]of r)e[o].push([s,s+c])}for(let[n,o]of Object.entries(e))o.sort((r,s)=>r[0]-s[0]),e[n]=lt(o);return e}function lt(t){if(!t.length)return t;let e=[],n=0,o=t[0][1];e[0]=t[0];for(let[r,s]of t.slice(1))r>o+5?(e.push([r,s]),o=s,n++):s>o&&(e[n][1]=s,o=s);return e}function K(t,e,n,o=0){let r=0;for(let[s,c]of n)s-=o,c-=o,t.push(e.slice(r,s)),t.push(rt(e.slice(s,c))),r=c;t.push(e.slice(r))}function ut(t,e,n){if(!e.length)return[];let o=t.length,r=a.maxHitsPerResult<=0?e.length:a.maxHitsPerResult,[s,c]=e[0],i=[{context:A(s-n,c+n,o),mark:[[s,c]]}],l=i[0];for(let[u,m]of e.slice(1,r)){let[g,f]=A(u-n,m+n,o);[s,c]=l.context,g<=c+8?(l.context[1]=f,l.mark.push([u,m])):(l={},l.context=[g,f],l.mark=[[u,m]],i.push(l))}return i.forEach(u=>at(u,t)),i}var d=new RegExp("[\\p{L}\\p{gc=Mark}\\p{gc=Connector_Punctuation}\\p{Join_Control}]","u");function _(t,e,n,o=1){let r=t.length;e<0?e=0:e>=r&&(e=r-1);let s=t[e];if(o>0){if(e===0||C.test(s)||d.test(s)&&!d.test(t[e-1]))return e}else if(o<0){if(e===r-1||C.test(s))return e+1;if(d.test(t[e-1])&&!d.test(s))return e}let c=!0,i=!1;for(r=e;o*(r-n)<0;r+=o){if(s=t[r],c){if(d.test(s))continue;c=!1,i=!0}if(i){if(!d.test(s))continue;break}}return r+(o<0)}function at(t,e){let n=t.context[0];t.context[0]=_(e,n,t.mark[0][0]),n=t.context[1],t.context[1]=_(e,n,t.mark.at(-1)[1],-1)}function A(t,e,n){return[Math.max(0,t),Math.min(e,n)]}function ft(t,e,n=45){let o=[],r=ut(t,e,n);o.push(p(r[0].context[0]>0?"\u2026 [":"["));let s=r.length-1;for(let c=0;c<=s;c++){let i=r[c],l=i.context[0],u=t.slice(...i.context);K(o,u,i.mark,l),c!=s&&o.push(p("] \u2026 ["))}return o.push(p(r.at(-1).context[1]<t.length?"] \u2026":"]")),o}function T(t){return v(t).split(/\s/).filter(Boolean).join(" ").toLowerCase()}var P=document.title;function w(t){document.title=t.length?P.replace(/^.+ -/,`( ${t} ) at`):P}function ht(t){let e=t.state?t.state:"";V(T(e)),h.value=e,w(e)}var N=(function(){let t=new URLSearchParams(location.search),e=t.get("Q");return e!==null&&(t.has("q")||t.set("q",e),t.delete("Q")),{get q(){return t.get("q")},set q(n){n?t.set("q",n):t.delete("q"),history.pushState(n,"",`${this}`),w(n)},toString(){let n=`${t}`;return`${location.pathname}${n&&`?${n}`}`}}})();function V(t){if(!t){W(),G();return}if(t===$){I?L(y.noResults):z();return}j(t)}function dt(t){t.preventDefault();let e=T(h.value);V(e),N.q=h.value}function mt(){let t=N.q;if(t){let e=T(t);e&&j(e),h.value=t,history.replaceState(t,"",`${N}`),w(t)}}X.then(t=>t.ok?t.json():Promise.reject("Fetch response not ok")).then(t=>{R=t;function e(n){function o(r){return r.update(()=>v(r.toString()))}lunr.Pipeline.registerFunction(o,"processDiac"),n.pipeline.before(lunr.stemmer,o)}q=lunr(function(){if(Array.isArray(a.lunrLanguages)){let n=new Set;a.lunrLanguages.forEach(r=>n.add(r)),n.add("en");let o=lunr.multiLanguage(...n);this.use(o)}this.use(e),this.field("author"),this.field("title"),this.field("content"),this.ref("i"),this.metadataWhitelist=["position"],this.k1(1.05),this.b(.6),R.forEach(n=>this.add(n))}),mt(),window.addEventListener("popstate",ht),document.getElementById("search-form").addEventListener("submit",dt),ot()}).catch(t=>{L("Error: Failed to load search data. Try reloading page?"),console.error(t)});})();
