(()=>{var p={noResults:"No results found."},f={indexURI:"/searchindex.json",lunrLanguages:["en","ru"],maxResults:25,maxSummaryLength:100};var g,y;async function z(){try{let e=await fetch(f.indexURI);if(e.status!==200)return;g=await e.json(),y=lunr(function(){if(Array.isArray(f.lunrLanguages)){let t=new Set;f.lunrLanguages.forEach(n=>t.add(n)),t.add("en");let o=lunr.multiLanguage(...t);this.use(o)}this.use(Q),this.field("author"),this.field("title"),this.field("content"),this.ref("revid"),this.metadataWhitelist=["position"],g.forEach(t=>this.add(t))}),document.dispatchEvent(new CustomEvent("indexed"))}catch(e){console.log(e)}}var H=new RegExp(/[\u0300-\u036f]/g);function T(e){return e.normalize("NFD").replace(H,"")}function Q(e){function t(o){let n=o.toString();return o.update(()=>T(n))}lunr.Pipeline.registerFunction(t,"normalizeDiac"),e.pipeline.before(lunr.stemmer,t)}var W=document.getElementById("search-display-tpl").content.querySelector("article"),b=document.createElement("mark");b.className="search-hit";var l=document.getElementById("search-output-region"),B=document.getElementById("search-input-container"),O=document.getElementById("search-error-container"),A=document.getElementById("search-error-content"),q=document.getElementById("search-results"),M=document.getElementById("results-count"),E=document.getElementById("search-results-body"),d=document.getElementById("search"),_=document.getElementById("search-act"),j,S=!1;function D(e){l.ariaBusy="true",l.setAttribute("aria-busy","true");let t=$(e);if(j=e,!t.length){S=!0,F(p.noResults),x(),l.ariaBusy="false",l.setAttribute("aria-busy","false");return}S=!1,R(),X(e,t),l.ariaBusy="false",l.setAttribute("aria-busy","false")}function $(e){let t=V(e);if(!t)return[];let o;try{o=G(t)}catch(n){if(n instanceof lunr.QueryParseError)return[];throw n}return o}function G(e){return typeof y=="undefined"?[]:y.search(e)}var K=new RegExp("\\p{sc=Han}","u");function J(e){return K.test(e)?!0:e.startsWith("+")||e.startsWith("-")?e.length>2:e.length>1}function V(e){let t=e.split(" ").filter(J);return t.every(o=>o.startsWith("-"))?"":t.join(" ")}function F(e){B.classList.add("form-item-error"),A.textContent=e,O.classList.remove("hide-element")}function R(){B.classList.remove("form-item-error"),O.classList.add("hide-element"),A.textContent=""}function P(){q.classList.remove("hide-element")}function x(){q.classList.add("hide-element")}function X(e,t){Y(),Z(e,t),P()}function Y(){E.textContent="",M.textContent=""}function w(e,t,o){let n=[];o?k(n,t,o):n.push(t),e.append(...n)}var L=new DocumentFragment;function Z(e,t){for(let o=0;o<Math.min(t.length,f.maxResults);o++){let n=t[o],r=g[n.ref],s=ee(n.matchData.metadata),i=W.cloneNode(!0),c=i.querySelector("a");w(c,r.title,s.title),c.href=r.href;let a=i.querySelector(".tm-date");a.textContent=r.date;let u=i.querySelector(".tm-author");w(u,r.author,s.author);let h=i.querySelector(".post-content"),m;s.content?m=re(r.content,s.content):(m=[r.content.slice(0,100)],r.content.length>100&&m.push(" \u2026")),h.append(...m),i.dataset.score=n.score.toFixed(2),i.normalize(),L.appendChild(i)}M.textContent=t.length.toString(),E.textContent="",E.appendChild(L)}function ee(e){let t={};for(let[,o]of Object.entries(e))for(let[n,{position:r}]of Object.entries(o)){t[n]||(t[n]=[]);for(let[s,i]of r)t[n].push([s,s+i])}for(let[o,n]of Object.entries(t))n.sort((r,s)=>r[0]-s[0]),t[o]=te(n);return t}function te(e){if(!e.length)return e;let t=[],o=0,n=e[0][1];t[0]=e[0];for(let[r,s]of e.slice(1))r>n?(t.push([r,s]),n=s,o++):s>n&&(t[o][1]=s,n=s);return t}function ne(e){let t=b.cloneNode(!1);return t.textContent=e,t}function k(e,t,o,n=0){let r=0;for(let[s,i]of o)s-=n,i-=n,e.push(t.slice(r,s)),e.push(ne(t.slice(s,i))),r=i;e.push(t.slice(r))}function oe(e,t,o){if(!t.length)return[];let[n,r]=t[0],s=[{context:N(n-o,r+o,e),mark:[[n,r]]}],i=s[0],c,a;for(let[u,h]of t.slice(1))[c,a]=N(u-o,h+o,e),[n,r]=i.context,c<=r?(i.context[1]=a,i.mark.push([u,h])):(i={},i.context=[c,a],i.mark=[[u,h]],s.push(i));return s}function N(e,t,o){return[Math.max(0,e),Math.min(t,o)]}function re(e,t,o=45){let n=[],r=oe(e.length,t,o);r[0].context[0]>0&&n.push("\u2026 ");let s=r.length-1;for(let i=0;i<=s;i++){let c=r[i],a=c.context[0],u=e.slice(...c.context);i!=s&&(u+=" \u2026 "),k(n,u,c.mark,a)}return r[r.length-1].context[1]<e.length&&n.push(" \u2026"),n}function U(e){return T(e).split(/\s/).filter(t=>!!t).join(" ").toLowerCase()}var I=new Proxy(new URLSearchParams(location.search),{get:(e,t)=>e.get(t),set:(e,t,o)=>{e.set(t,o),window.history.replaceState({},"",`${location.pathname}?${e}`)},deleteProperty:(e,t)=>{e.delete(t),window.history.replaceState({},"",`${location.pathname}`)}});function v(e){if(e.preventDefault(),!d.value){R(),x(),delete I.q;return}let t=U(d.value);if(!t){R(),x();return}if(t===j){S?F(p.noResults):P();return}D(t),I.q=d.value}document.addEventListener("DOMContentLoaded",()=>{let e=document.getElementById("search-form");e===null||d===null||_===null||(e.addEventListener("submit",v),_.addEventListener("click",v))});document.addEventListener("indexed",()=>{let e=I.q;if(e){let t=U(e);t&&D(t),d.value=e}});z();})();
