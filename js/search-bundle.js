"use strict";(()=>{var y={noResults:"No results found."},a={indexURI:"/searchindex.json",lunrLanguages:["en","ru"],maxHitsPerResult:5,maxResults:25};var R,k,X=fetch(a.indexURI);document.getElementById("search-app").classList.remove("hide-element");var Y=new RegExp(/[\u0300-\u036f]/g);function v(t){return t.normalize("NFD").replace(Y,"")}var Z=document.getElementById("search-display-tpl").content.querySelector("article"),P=document.createElement("mark");P.className="search-hit";var E=document.getElementById("search-output-region"),F=document.getElementById("search-input-container"),M=document.getElementById("search-error-container"),Q=document.getElementById("search-error-content"),q=document.getElementById("search-results"),H=document.getElementById("results-count"),S=document.getElementById("search-results-body"),d=document.getElementById("search"),D,I=!1;function U(t){st();let e=tt(t);if(D=t,!e.length){I=!0,_(y.noResults),z(),B();return}I=!1,W(),S.textContent="",H.textContent="",ct(t,e),$(),B()}function tt(t){let e=nt(t);if(!e)return[];try{return k.search(e)}catch(o){if(o instanceof lunr.QueryParseError)return[];throw o}}var j=new RegExp("\\p{sc=Han}","u");function et(t){return j.test(t)?!0:t.startsWith("+")||t.startsWith("-")?t.length>2:t.length>1}function nt(t){let e=t.split(" ").filter(et);return e.every(o=>o.startsWith("-"))?"":e.join(" ")}function ot(){d.removeAttribute("readonly");let t=document.getElementById("search-act");t&&t.removeAttribute("disabled"),d.removeAttribute("placeholder"),d.focus()}function _(t){F.classList.add("form-item-error"),Q.textContent=t,M.classList.remove("hide-element")}function W(){M.classList.add("hide-element"),F.classList.remove("form-item-error"),Q.textContent=""}function st(){E.ariaBusy="true",E.setAttribute("aria-busy","true")}function B(){E.ariaBusy="false",E.setAttribute("aria-busy","false")}function $(){q.classList.remove("hide-element")}function z(){q.classList.add("hide-element")}function rt(t){let e=P.cloneNode(!1);return e.textContent=t,e}var G=document.createElement("span");G.className="ell";function p(t){let e=G.cloneNode(!1);return e.textContent=t,e}function b(t,e,o){let n=[];o?J(n,e,o):n.push(e),t.append(...n)}var x=new DocumentFragment;function ct(t,e){let o;a.maxResults<=0?o=e.length:o=Math.min(e.length,a.maxResults);for(let n=0;n<o;n++){let s=e[n],r=R[s.ref],c=it(s.matchData.metadata),i=Z.cloneNode(!0),l=i.querySelector("a");b(l,r.title,c.title),l.href=new URL(r.href,location.origin).href;let h=i.querySelector(".tm-date");h.textContent=r.date;let g=i.querySelector(".tm-author");b(g,r.author,c.author);let f=i.querySelector(".post-content"),u;if(c.content)u=ht(r.content,c.content);else{let L=C(r.content,100,0,-1);u=[r.content.slice(0,L)],r.content.length>L&&u.push(p(" \u2026"))}f.append(...u),i.dataset.score=s.score.toFixed(2),i.normalize(),x.appendChild(i)}H.textContent=e.length.toString(),S.textContent="",S.appendChild(x)}function it(t){let e={};for(let[,o]of Object.entries(t))for(let[n,{position:s}]of Object.entries(o)){e[n]||(e[n]=[]);for(let[r,c]of s)e[n].push([r,r+c])}for(let[o,n]of Object.entries(e))n.sort((s,r)=>s[0]-r[0]),e[o]=lt(n);return e}function lt(t){if(!t.length)return t;let e=[],o=0,n=t[0][1];e[0]=t[0];for(let[s,r]of t.slice(1))s>n?(e.push([s,r]),n=r,o++):r>n&&(e[o][1]=r,n=r);return e}function J(t,e,o,n=0){let s=0;for(let[r,c]of o)r-=n,c-=n,t.push(e.slice(s,r)),t.push(rt(e.slice(r,c))),s=c;t.push(e.slice(s))}function ut(t,e,o){if(!e.length)return[];let n=t.length,s=a.maxHitsPerResult<=0?e.length:a.maxHitsPerResult,[r,c]=e[0],i=[{context:O(r-o,c+o,n),mark:[[r,c]]}],l=i[0],h,g;for(let[f,u]of e.slice(1,s))[h,g]=O(f-o,u+o,n),[r,c]=l.context,h<=c?(l.context[1]=g,l.mark.push([f,u])):(l={},l.context=[h,g],l.mark=[[f,u]],i.push(l));return i.forEach(f=>{at(f,t)}),i}var m=new RegExp("[\\p{L}\\p{gc=Mark}\\p{gc=Connector_Punctuation}\\p{Join_Control}]","u");function C(t,e,o,n=1){if(e===0&&n>0||e===t.length&&n<0||j.test(t[e]))return e;if(n>0){if(m.test(t[e])&&!m.test(t[e-1]))return e}else if(n<0&&m.test(t[e-1])&&!m.test(t[e]))return e;let s,r=!0,c=!1;for(s=e;n*(s-o)<0;s+=n){if(r){if(m.test(t[s]))continue;r=!1,c=!0}if(c){if(!m.test(t[s]))continue;break}}return s+(n<0)}function at(t,e){let o=t.context[0];t.context[0]=C(e,o,t.mark[0][0]),o=t.context[1],t.context[1]=C(e,o,t.mark.at(-1)[1],-1)}function O(t,e,o){return[Math.max(0,t),Math.min(e,o)]}function ht(t,e,o=45){let n=[],s=ut(t,e,o);n.push(p(s[0].context[0]>0?"\u2026 [":"["));let r=s.length-1;for(let c=0;c<=r;c++){let i=s[c],l=i.context[0],h=t.slice(...i.context);J(n,h,i.mark,l),c!=r&&n.push(p("] \u2026 ["))}return n.push(p(s.at(-1).context[1]<t.length?"] \u2026":"]")),n}function w(t){return v(t).split(/\s/).filter(Boolean).join(" ").toLowerCase()}var A=document.title;function N(t){document.title=t.length?A.replace(/^.+ -/,`( ${t} ) at`):A}function ft(t){let e=t.state?t.state:"";V(w(e)),d.value=e,N(e)}var K=new function(){let t=new URLSearchParams(location.search),e=t.get("Q");e&&(t.has("q")||t.set("q",e),t.delete("Q")),this.get=o=>t.get(o),this.set=(o,n)=>{n?t.set(o,n):t.delete(o);let s=`${t}`;s=s&&`?${s}`,window.history.pushState(n,"",`${location.pathname}${s}`),N(n)}};function V(t){if(!t){W(),z();return}if(t===D){I?_(y.noResults):$();return}U(t)}function dt(t){t.preventDefault();let e=w(d.value);V(e),K.set("q",d.value)}function mt(){let t=K.get("q");if(t){let e=w(t);e&&U(e),d.value=t,window.history.replaceState(t,"",""),N(t)}}X.then(t=>t.ok?t.json():Promise.reject("Fetch response not ok")).then(t=>{R=t;function e(o){function n(s){return s.update(()=>v(s.toString()))}lunr.Pipeline.registerFunction(n,"processDiac"),o.pipeline.before(lunr.stemmer,n)}k=lunr(function(){if(Array.isArray(a.lunrLanguages)){let o=new Set;a.lunrLanguages.forEach(s=>o.add(s)),o.add("en");let n=lunr.multiLanguage(...o);this.use(n)}this.use(e),this.field("author"),this.field("title"),this.field("content"),this.ref("revid"),this.metadataWhitelist=["position"],this.k1(1.05),this.b(.6),R.forEach(o=>this.add(o))}),mt(),window.addEventListener("popstate",ft),document.getElementById("search-form").addEventListener("submit",dt),ot()}).catch(t=>{_("Error: Failed to load search data. Try reloading page?"),console.error(t)});})();
